<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Content Security Policy (development): allow trusted CDNs, googleusercontent published CSV hosts and local proxy. Tighten for production. -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: https:; script-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https: data:; connect-src 'self' https://sheets.googleapis.com https://docs.google.com https://*.googleusercontent.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PROCASEF Boundou Operations Dashboard - Comprehensive agricultural land management insights">
    <meta name="keywords" content="PROCASEF, Boundou, agriculture, land management, dashboard, data visualization">
    <meta name="author" content="PROCASEF Boundou Operations">
    <meta property="og:title" content="PROCASEF Boundou Operations Dashboard">
    <meta property="og:description" content="Interactive dashboard for PROCASEF Boundou, providing real-time data, projections, and quality metrics.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://procasef.example.com/og-image.jpg">
    <title>PROCASEF Boundou Operations Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-sankey@0.2.0/dist/chartjs-chart-sankey.min.js"></script>
    <script src="script.js" defer></script>
    <script src="dashboard_js.js" defer></script>
    <script src="dashboard_charts.js" defer></script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "PROCASEF Boundou Operations Dashboard",
        "description": "Real-time dashboard for agricultural land management in the Boundou region.",
        "applicationCategory": "Data Visualization",
        "operatingSystem": "All"
    }
    </script>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <span>Chargement des données...</span>
    </div>

    <div class="notification-toast" id="notificationToast">
        <i class="fas fa-exclamation-circle"></i>
        <span id="notificationMessage"></span>
        <button class="close-btn" onclick="document.getElementById('notificationToast').classList.remove('show')" aria-label="Close notification">&times;</button>
    </div>

    <div class="modal" id="exportModal">
        <div class="modal-content">
            <h2>Export Data</h2>
            <p>Choose export format:</p>
            <button class="btn-primary" id="exportCSVBtn">CSV</button>
            <button class="btn-primary" id="exportExcelBtn">Excel</button>
            <button class="btn-secondary" onclick="document.getElementById('exportModal').classList.remove('show')">Cancel</button>
        </div>
    </div>

    <div class="dashboard-container">
        <aside class="sidebar" aria-label="Main navigation">
            <div class="sidebar-header">
                <img src="logo.svg" alt="PROCASEF Logo" aria-hidden="true">
                <h2>PROCASEF Boundou</h2>
            </div>
            <ul class="nav-links" role="navigation">
                <li class="nav-item active" data-tab="overview" role="button" tabindex="0"><i class="fas fa-home"></i> <span>Vue d'ensemble</span></li>
                <li class="nav-item" data-tab="communes" role="button" tabindex="0"><i class="fas fa-map"></i> <span>Communes</span></li>
                <li class="nav-item" data-tab="progress" role="button" tabindex="0"><i class="fas fa-chart-line"></i> <span>Avancement</span></li>
                <li class="nav-item" data-tab="analytics" role="button" tabindex="0"><i class="fas fa-chart-bar"></i> <span>Analytique</span></li>
                <li class="nav-item" data-tab="quality" role="button" tabindex="0"><i class="fas fa-check-circle"></i> <span>Contrôle Qualité</span></li>
                <li class="nav-item" data-tab="workflow" role="button" tabindex="0"><i class="fas fa-project-diagram"></i> <span>Flux Opérationnel</span></li>
                <li class="nav-item" data-tab="reports" role="button" tabindex="0"><i class="fas fa-file-alt"></i> <span>Rapports</span></li>
                <li class="nav-item" data-tab="settings" role="button" tabindex="0"><i class="fas fa-cog"></i> <span>Paramètres</span></li>
            </ul>
        </aside>

        <main class="main-content" role="main">
            <header class="header">
                <div class="header-left">
                    <button class="sidebar-toggle" aria-label="Toggle sidebar"><i class="fas fa-bars"></i></button>
                    <h1 class="page-title">PROCASEF Dashboard</h1>
                </div>
                <div class="header-right">
                    <button class="refresh-button" id="refreshDataBtn" title="Refresh Data" aria-label="Refresh data"><i class="fas fa-sync-alt"></i></button>
                    <div class="search-box">
                        <i class="fas fa-search" aria-hidden="true"></i>
                        <input type="text" id="searchInput" placeholder="Search communes, geomaticians, or metrics..." aria-label="Search dashboard">
                    </div>
                    <button id="exportBtn" title="Export Data" aria-label="Open export options"><i class="fas fa-download"></i></button>
                    <button id="darkModeToggle" title="Toggle Dark Mode" aria-label="Toggle dark mode"><i class="fas fa-moon"></i></button>
                    <button class="user-menu" title="User Menu" aria-label="User menu"><i class="fas fa-user"></i></button>
                </div>
            </header>

            <section class="content">
                <!-- Executive Summary -->
                <div id="overview" class="tab-content active">
                    <div class="metrics-grid">
                        <div class="kpi-card" role="region" aria-label="Total Collected Parcels">
                            <div class="kpi-value" id="totalCollected">0</div>
                            <div class="kpi-label">Parcelles Collectées</div>
                            <div class="kpi-trend"><i class="fas fa-arrow-up"></i> <span id="collectedTrend">0%</span></div>
                        </div>
                        <div class="kpi-card" role="region" aria-label="Total Surveyed Parcels">
                            <div class="kpi-value" id="totalSurveyed">0</div>
                            <div class="kpi-label">Parcelles Enquêtées</div>
                            <div class="kpi-trend"><i class="fas fa-arrow-up"></i> <span id="surveyedTrend">0%</span></div>
                        </div>
                        <div class="kpi-card" role="region" aria-label="Total Validated Parcels">
                            <div class="kpi-value" id="totalValidated">0</div>
                            <div class="kpi-label">Parcelles Validées</div>
                            <div class="kpi-trend"><i class="fas fa-arrow-up"></i> <span id="validatedTrend">0%</span></div>
                        </div>
                        <div class="kpi-card" role="region" aria-label="Total Rejected Parcels">
                            <div class="kpi-value" id="totalRejected">0</div>
                            <div class="kpi-label">Parcelles Rejetées</div>
                            <div class="kpi-trend"><i class="fas fa-arrow-down"></i> <span id="rejectedTrend">0%</span></div>
                        </div>
                        <div class="kpi-card" role="region" aria-label="NICAD Progress">
                            <div class="progress-ring">
                                <svg viewBox="0 0 36 36" aria-hidden="true">
                                    <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <path class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                </svg>
                                <span class="progress-value" id="nicadPercentage">0%</span>
                            </div>
                            <div class="kpi-label">NICAD</div>
                        </div>
                        <div class="kpi-card" role="region" aria-label="CTASF Progress">
                            <div class="progress-ring">
                                <svg viewBox="0 0 36 36" aria-hidden="true">
                                    <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <path class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                </svg>
                                <span class="progress-value" id="ctasfPercentage">0%</span>
                            </div>
                            <div class="kpi-label">CTASF</div>
                        </div>
                        <div class="kpi-card" role="region" aria-label="Deliberation Progress">
                            <div class="progress-ring">
                                <svg viewBox="0 0 36 36" aria-hidden="true">
                                    <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <path class="circle" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                </svg>
                                <span class="progress-value" id="deliberationPercentage">0%</span>
                            </div>
                            <div class="kpi-label">Délibération</div>
                        </div>
                    </div>
                    <div class="charts-grid">
                        <div class="chart-container">
                            <div class="chart-header"><h3>État du Traitement</h3></div>
                            <canvas id="statusChart" aria-label="Chart showing parcel processing status"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Principales Communes par Volume</h3></div>
                            <canvas id="communesChart" aria-label="Chart showing top communes by parcel volume"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Répartition Régionale</h3></div>
                            <canvas id="regionChart" aria-label="Chart showing regional distribution of parcels"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Communes -->
                <div id="communes" class="tab-content">
                    <div class="table-controls">
                        <div id="columnFilter">
                            <button class="dropdown-toggle" aria-label="Configure table columns">Configurer les colonnes</button>
                            <div class="dropdown-menu" id="columnFilterMenu"></div>
                        </div>
                        <button class="btn-primary" id="openExportModal" aria-label="Open export options">Exporter</button>
                    </div>
                    <table id="communesTable" aria-label="Communes data table">
                        <thead>
                            <tr>
                                <th scope="col">Commune</th>
                                <th scope="col">Région</th>
                                <th scope="col">Collected</th>
                                <th scope="col">Surveyed</th>
                                <th scope="col">Retained</th>
                                <th scope="col">Validated</th>
                                <th scope="col">Rejected</th>
                                <th scope="col">Geomatician</th>
                                <th scope="col">Status</th>
                            </tr>
                        </thead>
                        <tbody id="communesTableBody"></tbody>
                    </table>
                </div>

                <!-- Progress -->
                <div id="progress" class="tab-content">
                    <div class="charts-grid">
                        <div class="chart-container">
                            <div class="chart-header"><h3>Projections Multi-mois</h3></div>
                            <canvas id="multiMonthProjectionChart" aria-label="Multi-month projection chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Chronologie des Assignations NICAD</h3></div>
                            <canvas id="nicadAssignmentChart" aria-label="NICAD assignments timeline chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Progression de l'Affichage Public</h3></div>
                            <canvas id="publicDisplayChart" aria-label="Public display progress chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Prévision d'Achèvement CTASF</h3></div>
                            <canvas id="ctasfCompletionChart" aria-label="CTASF completion forecast chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Analytics -->
                <div id="analytics" class="tab-content">
                    <div class="charts-grid">
                        <div class="chart-container">
                            <div class="chart-header"><h3>Répartition par Phase de Collecte</h3></div>
                            <canvas id="collectionPhaseChart" aria-label="Collection phase distribution chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Utilisation des Outils</h3></div>
                            <canvas id="toolUtilizationChart" aria-label="Tool utilization chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Tendance de Collecte Journalière</h3></div>
                            <canvas id="dailyCollectionTrendChart" aria-label="Daily collection trend chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Performance des Géomaticiens</h3></div>
                            <canvas id="geomaticianPerformanceChart" aria-label="Geomatician performance chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Quality Control -->
                <div id="quality" class="tab-content">
                    <div class="charts-grid">
                        <div class="chart-container">
                            <div class="chart-header"><h3>Analyse des Taux d'Erreur</h3></div>
                            <canvas id="errorRateChart" aria-label="Error rate analysis chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Efficacité de Suppression des Doublons</h3></div>
                            <canvas id="duplicateRemovalChart" aria-label="Duplicate removal efficiency chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Statistiques de Validation URM</h3></div>
                            <canvas id="urmValidationChart" aria-label="URM validation statistics chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Métriques de Score Qualité</h3></div>
                            <canvas id="qualityScoreChart" aria-label="Quality score metrics chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Workflow -->
                <div id="workflow" class="tab-content">
                    <div class="charts-grid">
                        <div class="chart-container">
                            <div class="chart-header"><h3>Visualisation du Flux de Processus</h3></div>
                            <canvas id="processFlowChart" aria-label="Process flow visualization chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Identification des Goulots d'Étranglement</h3></div>
                            <div id="bottleneckIndicators" aria-label="Bottleneck indicators"></div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Adhérence à la Méthodologie</h3></div>
                            <div id="methodologyChecklist" aria-label="Methodology adherence checklist"></div>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header"><h3>Classement d'Efficacité des Équipes</h3></div>
                            <canvas id="teamEfficiencyChart" aria-label="Team efficiency ranking chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Reports -->
                <div id="reports" class="tab-content">
                    <div class="report-grid">
                        <div class="report-card">
                            <h3>Rapport Mensuel</h3>
                            <p>Summary of monthly activities, parcel collection, and validation progress.</p>
                            <button class="btn-primary">Download PDF</button>
                        </div>
                        <div class="report-card">
                            <h3>Rapport Qualité</h3>
                            <p>Detailed quality control metrics, error rates, and validation statistics.</p>
                            <button class="btn-primary">Download PDF</button>
                        </div>
                        <div class="report-card">
                            <h3>Rapport Opérationnel</h3>
                            <p>Operational insights, team performance, and bottleneck analysis.</p>
                            <button class="btn-primary">Download PDF</button>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <div id="settings" class="tab-content">
                    <div class="settings-grid">
                        <div class="settings-card">
                            <h3>Préférences d'Affichage</h3>
                            <label><input type="checkbox" id="autoRefreshToggle"> Auto-refresh data</label>
                            <label><input type="checkbox" id="darkModeDefault"> Dark mode par défaut</label>
                        </div>
                        <div class="settings-card">
                            <h3>Gestion des Données</h3>
                            <button class="btn-primary" id="clearCacheBtn">Clear Cache</button>
                            <button class="btn-primary" id="exportAllDataBtn">Export All Data</button>
                        </div>
                    </div>
                </div>
            </section>

            <footer role="contentinfo">
                <p>© 2025 PROCASEF Boundou Operations</p>
                <p>Source des données: Google Sheets</p>
                <p id="lastRefreshTime"></p>
            </footer>
        </main>
    </div>
<!-- Removed an injected iframe/script that attempted to load Cloudflare challenge code; it caused 404s in local/dev. -->
</body>
</html>